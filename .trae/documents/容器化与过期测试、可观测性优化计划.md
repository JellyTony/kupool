## 目标
- 增补“任务过期”与“客户端至少 1 次/分钟”单元测试，提升可测试性覆盖。
- 提供容器化依赖（PostgreSQL、RabbitMQ），一条命令本地端到端演示。
- 增强可观测性（简易指标与日志），以及长时运行的内存清理策略。

## 实施项
1) 任务过期测试
- 在 `app/server` 新增用例：设置 `expireAfter=500ms`，广播后延迟 ≥500ms 提交，断言服务端错误 `Task expired`。
- 保持现有 `t.Cleanup(app.Shutdown())`，确保测试自动终止。

2) 客户端最少 1 次/分钟测试
- 在 `client/app` 或 `app/server` 的集成测试中，缩短分钟周期（例如用 `time.Second*3` 替代），验证一分钟保底提交生效（通过服务端统计或响应日志断言）。

3) 容器化依赖
- 新增 `docker-compose.yml`：
  - `postgres:15` 暴露 5432，初始化数据库；
  - `rabbitmq:3-management` 暴露 5672/15672；
- README 增加：`docker-compose up -d`、设置 `KUP_PG_DSN`、`KUP_MQ_URL` 的示例，启动服务端选择 `pg`+`rabbit` 跑通端到端。

4) 可观测性与日志
- 简易指标：在 `AppServer` 增加内存计数器（提交成功/失败/速率限制/重复），暴露为日志快照周期输出，或提供 `http` 端点 `/metrics`（文本统计）。
- 日志：已支持 `KUP_LOG_LEVEL`；在 README 中增加日志级别与关键日志点说明（已完成）。

5) 内存清理策略
- 在 `Coordinator` 中为 `UsedNonces` 维护近 N 个 `job_id` 的窗口（例如最近 64 个任务），周期性清理老任务的 nonce 集，降低内存占用。

## 交付与验证
- 运行：`go build ./...`；测试：`go test ./protocol ./stats ./mq ./app/server -v`。
- 容器化：`docker-compose up -d` 后，配置 `KUP_PG_DSN` 与 `KUP_MQ_URL`，服务端选择 `pg` 与 `rabbit`，客户端提交与统计入库、队列消费正常。

## 备注
- 可选：将 `/metrics` 替换为 Prometheus 指标；也可保留为日志快照以简化依赖。
- 如需要，我会按此计划直接补齐所有代码与文档，并提交验证。
## 现状结论
- 服务端任务分发：满足要求
  - 每 30 秒更新 `server_nonce` 并递增 `job_id`（app/server/coordinator.go:40–61）。
  - 广播任务并在会话中维护最新 `server_nonce`（app/server/coordinator.go:70–89，app/server/types.go:9–16）。
  - 维护历史记录（app/server/types.go:27–30；app/server/coordinator.go:60–61）。
- 服务端校验与限速：满足要求
  - 校验 `job_id`、`server_nonce`、结果正确性；1 秒最多一次；检测重复 `client_nonce`；错误响应正确（app/server/listener.go:49–88, 90–95）。
  - 可选过期逻辑已实现但默认禁用（`expireAfter=0`）（app/server/server.go:16–26；app/server/coordinator.go:12, 20）。
- 客户端提交逻辑：基本满足但有一个缺口
  - 随机 `client_nonce`，计算 `SHA256(server_nonce+client_nonce)`；提交频率：最多 1 次/秒，最少 1 次/分钟（client/app/client.go:67–77, 82–93；128–137）。
  - 缺口：收到任务后“立即开始结果计算”未触发，当前仅在下一次 1 秒 tick 时开始（client/app/client.go:51–57 后无立即提交）。

## 拟修复方案
### 客户端：收到 job 后立即计算并提交一次
1. 在 `client/app/client.go:51–57`（处理 `method == "job"`）中，更新本地 `server_nonce` 与 `job_id` 后，立刻执行一次提交：
   - 生成 `clientNonce := randNonce()`；`res := computeSHA256Hex(c.serverNonce + clientNonce)`。
   - 递增 `c.nextID`，构造 `Request{ID, Method:"submit", Params}` 并编码后通过 `c.cli.Send(data)` 发送。
   - 更新 `lastSubmit = time.Now()` 并记录日志 `submit sent (immediate)`。
2. 保留原有每秒与每分钟的保护逻辑，确保不超过 1 次/秒，且至少 1 次/分钟。

### （可选）服务端：开放过期配置
- 在 `cmd/kupool-server/main.go` 增加 `-expire`（或 `KUP_EXPIRE`）参数，传入 `NewCoordinator(..., expire)`，启用 "Task expired" 的校验（app/server/listener.go:59–61）。

## 验证方案
- 单元/集成：
  - 启动服务端与客户端，观察客户端在收到第一次 `job` 后立刻出现一次提交日志，其后遵循 1 秒/1 分钟的节律。
  - 人为构造重复 `client_nonce`、错误结果、过频提交，确认服务端错误响应与日志符合预期。
- 运行：
  - `go build ./...` 编译通过；本地双进程演示交互。

## 交付
- 最小化改动，仅修改 `client/app/client.go` 的 `Run()` 内部逻辑以增加一次“立即提交”。
- 可选增加服务端过期参数，不影响现有默认行为。